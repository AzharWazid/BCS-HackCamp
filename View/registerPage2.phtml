<?php require_once('template/header.phtml'); ?>

<div class="container mt-5">
    <h1 class="text-center b-colour">Additional Information</h1>
    <p class="lead text-center b-colour">Please provide more details to help us find the best placements for you.</p>

    <form action="registerPage2.phtml" method="POST" enctype="multipart/form-data">
        <!-- Dynamic Dropdown Section -->
        <div id="dynamic-dropdown-section">
            <div class="row mb-3">
                <!-- Skills Dropdown -->
                <div class="col-md-4">
                    <label for="skills-1" class="form-label">Skills</label>
                    <select class="form-select" id="skills-1" name="skills[]">
                        <option value="">Select a skill</option>
                        <option value="Data Management">Data Management</option>
                        <option value="Digital Forensics">Digital Forensics</option>
                        <option value="Employee Experience">Employee Experience</option>
                        <option value="High Performance Computing">High-Performance Computing</option>
                        <option value="Innovation">Innovation</option>
                        <option value="IT Infrastructure">IT Infrastructure</option>
                        <option value="Machine Learning">Machine Learning</option>
                        <option value="Methods and Tools">Methods and Tools</option>
                        <option value="Numerical Analysis">Numerical Analysis</option>
                        <option value="Portfolio Management">Portfolio Management</option>
                    </select>
                </div>

                <!-- Categories Dropdown -->
                <div class="col-md-4">
                    <label for="categories-1" class="form-label">Category</label>
                    <select class="form-select" id="categories-1" name="categories[]">
                        <option value="">Select a category</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Business">Business</option>
                        <option value="Communication Skills">Communication Skills</option>
                        <option value="Data Science">Data Science</option>
                        <option value="Marketing">Marketing</option>
                    </select>
                </div>

                <!-- Levels Dropdown -->
                <div class="col-md-4">
                    <label for="levels-1" class="form-label">Level</label>
                    <select class="form-select" id="levels-1" name="levels[]">
                        <option value="">Select a level</option>
                        <option value="Level 1">Level 1</option>
                        <option value="Level 2">Level 2</option>
                        <option value="Level 3">Level 3</option>
                        <option value="Level 4">Level 4</option>
                        <option value="Level 5">Level 5</option>
                        <option value="Level 6">Level 6</option>
                        <option value="Level 7">Level 7</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Add More Button -->
        <div class="text-center mb-4">
            <button type="button" class="btn btn-secondary" id="add-more">Add More</button>
        </div>

        <!-- CV Upload Section -->
        <div class="mt-4 b-colour">
            <h3>Upload Your CV</h3>
            <div class="mb-3">
                <label for="cvUpload" class="form-label">Upload CV</label>
                <input class="form-control" type="file" id="cvUpload" name="cv_file" accept=".pdf,.doc,.docx" required>
            </div>
        </div>

        <!-- Register Button -->
        <div class="d-grid gap-2 col-6 mx-auto mt-4">
            <button class="btn btn-success" type="submit" name="register">Register</button>
        </div>
    </form>

    <script>
        let dropdownIndex = 1; // Keep track of dropdown sets

        document.getElementById('add-more').addEventListener('click', function() {
            dropdownIndex++;
            const dynamicSection = document.getElementById('dynamic-dropdown-section');

            // Create a new row
            const newRow = document.createElement('div');
            newRow.classList.add('row', 'mb-3');

            // Skills Dropdown
            newRow.innerHTML += `
                <div class="col-md-4">
                    <label for="skills-${dropdownIndex}" class="form-label">Skills</label>
                    <select class="form-select" id="skills-${dropdownIndex}" name="skills[]">
                        <option value="">Select a skill</option>
                        <option value="Data Management">Data Management</option>
                        <option value="Digital Forensics">Digital Forensics</option>
                        <option value="Employee Experience">Employee Experience</option>
                        <option value="High Performance Computing">High-Performance Computing</option>
                        <option value="Innovation">Innovation</option>
                        <option value="IT Infrastructure">IT Infrastructure</option>
                        <option value="Machine Learning">Machine Learning</option>
                        <option value="Methods and Tools">Methods and Tools</option>
                        <option value="Numerical Analysis">Numerical Analysis</option>
                        <option value="Portfolio Management">Portfolio Management</option>
                    </select>
                </div>`;

            // Categories Dropdown
            newRow.innerHTML += `
                <div class="col-md-4">
                    <label for="categories-${dropdownIndex}" class="form-label">Category</label>
                    <select class="form-select" id="categories-${dropdownIndex}" name="categories[]">
                        <option value="">Select a category</option>
                        <option value="Computer Science">Computer Science</option>
                        <option value="Business">Business</option>
                        <option value="Communication Skills">Communication Skills</option>
                        <option value="Data Science">Data Science</option>
                        <option value="Marketing">Marketing</option>
                    </select>
                </div>`;

            // Levels Dropdown
            newRow.innerHTML += `
                <div class="col-md-4">
                    <label for="levels-${dropdownIndex}" class="form-label">Level</label>
                    <select class="form-select" id="levels-${dropdownIndex}" name="levels[]">
                        <option value="">Select a level</option>
                        <option value="Level 1">Level 1</option>
                        <option value="Level 2">Level 2</option>
                        <option value="Level 3">Level 3</option>
                        <option value="Level 4">Level 4</option>
                        <option value="Level 5">Level 5</option>
                        <option value="Level 6">Level 6</option>
                        <option value="Level 7">Level 7</option>
                    </select>
                </div>`;

            // Append the new row
            dynamicSection.appendChild(newRow);
        });
    </script>

    <?php
    // Handle form submission
    if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['register'])) {
        // Handle CV upload
        if (isset($_FILES['cv_file'])) {
            $uploadDir = 'uploads/';
            if (!is_dir($uploadDir)) {
                mkdir($uploadDir, 0777, true);
            }

            $cvFile = $uploadDir . basename($_FILES['cv_file']['name']);

            if (move_uploaded_file($_FILES['cv_file']['tmp_name'], $cvFile)) {
                echo "<div class='alert alert-success mt-3' role='alert'>CV uploaded successfully!</div>";
                $_SESSION['uploaded_cv'] = $cvFile;
            } else {
                echo "<div class='alert alert-danger mt-3' role='alert'>Failed to upload CV. Please try again.</div>";
            }
        }

        // Process selected skills
        if (isset($_POST['skills'])) {
            $selectedSkills = $_POST['skills'];
            echo "<div class='alert alert-info mt-3' role='alert'>Skills selected: " . implode(', ', $selectedSkills) . "</div>";
        }

        // Process selected categories
        if (isset($_POST['categories'])) {
            $selectedCategories = $_POST['categories'];
            echo "<div class='alert alert-info mt-3' role='alert'>Categories selected: " . implode(', ', $selectedCategories) . "</div>";
        }

        // Process selected levels
        if (isset($_POST['levels'])) {
            $selectedLevels = $_POST['levels'];
            echo "<div class='alert alert-info mt-3' role='alert'>Levels selected: " . implode(', ', $selectedLevels) . "</div>";
        }
    }
    ?>
</div>

<?php require_once("template/footer.phtml"); ?>
